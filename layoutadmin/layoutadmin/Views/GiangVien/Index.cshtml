
@{
    ViewBag.Title = "Trang Giảng Viên";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    /*table {
        border-collapse: collapse;
        width: 100%;
        max-width: 800px;
        margin: 0 auto;
        font-family: Arial, sans-serif;
        color: #333;
    }

    th {
        background-color: #f2f2f2;
        font-weight: bold;
    }

    th, td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: left;
    }

    tr:nth-child(even) {
        background-color: #f2f2f2;
    }*/
    /*.pagination {
        display: flex;
        align-items: center;
        position: absolute;
        bottom: 0;
        justify-content: center;
    }

    .pagination-number, .pagination-button {
        font-size: 1.1rem;
        background-color: transparent;
        border: none;
        margin: 0.25rem 0.25rem;
        cursor: pointer;
        height: 2.5rem;
        width: 2.5rem;
        border-radius: .2rem;
    }

        .pagination-number:hover, .pagination-button:not(.disabled):hover {
            background: #fff;
        }

        .pagination-number.active {
            color: #fff;
            background: #0085b6;
        }*/
    .pagination {
        display: flex;
        align-items: center;
        position: absolute;
        bottom: 0;
        justify-content: center;
    }

    .pagination-number, .pagination-button {
        font-size: 1.1rem;
        background-color: transparent;
        border: none;
        margin: 0.25rem 0.25rem;
        cursor: pointer;
        height: 2.5rem;
        width: 2.5rem;
        border-radius: .2rem;
    }

        .pagination-number:hover, .pagination-button:not(.disabled):hover {
            background: #fff;
        }

        .pagination-number.active {
            color: #fff;
            background: #0085b6;
        }

    .btn {
        background-color: chartreuse;
        border-color: crimson;
        box-shadow: inset 0 1px 5px rgba(0, 0, 0, 0.075);
        border-radius: 50%;
    }

        .btn:hover {
            background-color: crimson;
            border-color: chartreuse;
            box-shadow: inset 0 1px 5px rgba(0, 0, 0, 0.075);
            border-radius: 10%;
        }

    .pagination-ellipsis {
        display: inline-block;
        padding: .5rem .75rem;
        margin-right: -.25rem;
        color: #999;
    }


</style>
<head>

</head>
<!-- Content Header (Page header) -->
<section class="content-header content">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">DataTable Giảng Viên</h3>
                    </div>
                    <!-- /.card-header -->
                    <div class="card-body">
                        <table id="myTable" class="table table-bordered table-hover">
                            <thead>

                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                    <!-- /.card-body -->
                </div>
                <!-- /.card -->
                <!-- /.card -->
            </div>
            <!-- /.col -->
        </div>
        <div class="row mb-2">
            <div class="col-sm-6">
                <input id="inpsearch" name="inpsearch" type="text" onkeyup="getsearch()" />



            </div>

            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                </ol>
            </div>
            <div id="pagination" class="pagination">

            </div>
        </div>
    </div><!-- /.container-fluid -->
</section>
<script>
    function Start() {
        getall();
    }
    Start();
    function getsearch() {
        var inpsearch = document.querySelector('input[name="inpsearch"]').value;
        if (inpsearch == "") {
            getall();
            return;
        }
        // Lấy dữ liệu từ API

        fetch("https://localhost:44364/api/GiangVien/Get-HoTen?hoten=" + inpsearch)
            .then(response => response.json())
            .then(data => {
                var page_limit = 50;
                renderTable(1, page_limit, data);
                renderPagination(1, page_limit, data);
            })
            .catch(error => console.error(error));
    }
    function getall() {
        // Lấy dữ liệu từ API
        fetch('https://localhost:44364/api/GiangVien/Get-all')
            .then(response => response.json())
            .then(data => {
                //    // Tạo các hàng trong bảng

                //    const rows = data.map(item => {
                //        return `
                //  <tr>
                //    <td>${item.idDanhMuc}</td>
                //    <td>${item.journal_name}</td>
                //    <td>${item.issn}</td>
                //    <td>${item.eissn}</td>
                //    <td>${item.category}</td>
                //    <td>${item.citations}</td>
                //    <td>${item.if_2022}</td>
                //    <td>${item.jci}</td>
                //    <td>${item.percentageOAGold}</td>
                //    <td>${item.userId}</td>
                //    <td>${item.rank}</td>
                //    <td>${item.image}</td>
                //    <td>${item.link}</td>
                //    <td>${item.tenBaiBao}</td>
                //    <td>${item.groupUser}</td>
                //  </tr>
                //`;
                //    });
                var page_limit = 10;
                renderTable(1, page_limit, data);
                renderPagination(1, page_limit, data);
                // Thêm các hàng vào tbody của bảng
                const tbody = document.querySelector('#myTable tbody');
                //tbody.innerHTML = rows.join('');
            })
            .catch(error => console.error(error));
    }
    function paginate(pageNumber, pageSize, data) {
        var startIndex = (pageNumber - 1) * pageSize;
        var endIndex = startIndex + pageSize;
        var paginatedData = data.slice(startIndex, endIndex);
        return paginatedData;
    }

    function renderTable(pageNumber, pageSize, data) {
        var table = $("<table>");
        table.append("<thead>< tr ><th>MaGV</th><th>HoTen</th><th>MaDV</th></thead > ");
        var tbody = $("<tbody>");
        var paginatedData = paginate(pageNumber, pageSize, data);

        paginatedData.forEach(function (row) {

            var tr = $("<tr>");
            tr.append("<td>" + row.maGV + "</td>");
            tr.append("<td>" + row.hoTen + "</td>");
            tr.append("<td>" + row.maDV + "</td>");

            tr.append('<td><button onclick="location.href=\'/GiangVien/Edit?MaGV=' + row.maGV + '\'">Edit</button></td>');
            tr.append('<td><button onclick=\'delete_item("' + row.maGV + '")\'>Delete</button></td>');

            tbody.append(tr);
        });
        table.append(tbody);

        $("#myTable").empty();
        $("#myTable").append(table);
    }
    function renderPagination1(pageNumber, pageSize, data) {
        var totalPages = Math.ceil(data.length / pageSize);
        var pagination = $("<div>");
        for (var i = 1; i <= totalPages; i++) {
            var link = $("<button class='pagination-number'>" + i + "</button>");
            if (i == pageNumber) {
                link.addClass("active");
            }
            pagination.append(link);
        }
        $("#pagination").empty();
        $("#pagination").append(pagination);
        $("#pagination button").click(function () {
            var pageNumber = $(this).text();
            renderTable(pageNumber, pageSize, data);
            renderPagination(pageNumber, pageSize, data);
        });
    }
    function renderPagination(pageNumber, pageSize, data) {
        var totalPages = Math.ceil(data.length / pageSize);
        var pagination = $("<div>");

        if (totalPages <= 5) {

            for (var i = 1; i <= totalPages; i++) {
                var link = $("<button class='pagination-number'>" + i + "</button>");
                if (i == pageNumber) {
                    link.addClass("active");
                }

                pagination.append(link);
            }
        }
        else {
            var no1 = $("<button class='pagination-number'>" + 1 + "</button>");
            if (pageNumber == 1) {
                no1.addClass("active");
            }
            var no2 = $("<button class='pagination-number'>" + 2 + "</button>");
            if (pageNumber == 2) {
                no2.addClass("active");
            }
            pagination.append(no1);
            pagination.append(no2);
            pagination.append($('<span class="pagination-ellipsis">&hellip;</span>'));

            for (var i = parseInt(pageNumber) - 1; i <= parseInt(pageNumber) + 1; i++) {
                if (i > 2 && i < totalPages) {
                    var link = $("<button class='pagination-number'>" + i + "</button>");
                    if (i == pageNumber) {
                        link.addClass("active");
                    }
                    pagination.append(link);
                }


            }
            var noZ = $("<button class='pagination-number'>" + totalPages + "</button>");
            if (pageNumber == totalPages) {
                noZ.addClass("active");
            }
            pagination.append($('<span class="pagination-ellipsis">&hellip;</span>'));
            pagination.append(noZ);
        }
        $("#pagination").empty();
        $("#pagination").append(pagination);
        $("#pagination button").click(function () {
            var pageNumber = $(this).text();
            renderTable(pageNumber, pageSize, data);
            renderPagination(pageNumber, pageSize, data);
        });
    }
    function delete_item(maGV) {
        if (confirm("Are you sure to delete?")) {
            fetch("https://localhost:44364/api/GiangVien/Delete/" + maGV, {
                method: 'DELETE'
            })
                .then(response => {
                    if (response.ok) {
                        alert('Data deleted successfully!');
                        // Chuyển trang về danh sách dữ liệu
                        window.location.href = '/GiangVien';
                    } else {
                        alert('Error deleting data.');
                    }
                });
        }

    }

</script>

